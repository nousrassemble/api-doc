<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>developers nous rassemble</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell","php"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">cURL</a>
              <a href="#" data-language-name="php">PHP</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='mailto:dev@nousrassemble.com'>Sign Up for a Developer Key</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the <strong>nousrassemble</strong> developer documentation. You will find here all technical informations to connect your website or application with the <strong>nousrassemble</strong> plateform.</p>

          <h1 id="api">API</h1>

<p>You can use our REST API to access <strong>nousrassemble</strong> API endpoints, where you can find all data and proposals for a tenant, a user, &hellip;</p>

<aside class="warning">API is still in beta and you cannot create an App from the backend right now. Please write to <a href="mailto:dev@nousrassemble.com">dev@nousrassemble.com</a> to get an API token.</aside>

<h2 id="tenant">Tenant</h2>

<p><strong>nousrassemble</strong> is a multi-tenancy plateform. To select a tenant for an endpoint, just use the tenant URL to query the API :</p>

<ul>
<li>Use <a href="https://saint-quentin.nousrassemble.com">https://saint-quentin.nousrassemble.com</a> to reach endpoints for tenant <em>Saint Quentin</em></li>
<li>Use <a href="https://grenoble.nousrassemble.com">https://grenoble.nousrassemble.com</a> to reach endpoints for tenant <em>Grenoble</em></li>
</ul>

<p>Some endpoint are global and cannot be reached with a tenant URL, so just use the global URL instead : <a href="https://www.nousrassemble.com">https://www.nousrassemble.com</a></p>

<h2 id="language">Language</h2>

<p>Some answers and actions can be localized, for example :</p>

<ul>
<li>error messages</li>
<li>notifications</li>
<li>global names for proposals</li>
<li>&hellip;</li>
</ul>

<p>Set the user wanted language in the URL like this :</p>

<ul>
<li><a href="https://www.nousrassemble.com/fr/">https://www.nousrassemble.com/fr/</a> for french for global endpoints</li>
<li><a href="https://grenoble.nousrassemble.com/en/">https://grenoble.nousrassemble.com/en/</a> for english on a specific tenant</li>
</ul>

          <h2 id="authentication">Authentication</h2>

<h3 id="retrieve-an-access-token">Retrieve an access token</h3>

<blockquote>
<p>To retrieve a bearer token, use this code:</p>
</blockquote>
<pre class="highlight shell"><code>curl --request POST <span class="se">\</span>
  --url https://www.nousrassemble.com/fr/oauth/access_token <span class="se">\</span>
  --header <span class="s1">'content-type: multipart/form-data; boundary=---011000010111000001101001'</span> <span class="se">\</span>
  --form <span class="nv">grant_type</span><span class="o">=</span>password <span class="se">\</span>
  --form <span class="nv">client_id</span><span class="o">=</span>120e3fc4c59a394f8560c8b8b8759b <span class="se">\</span>
  --form <span class="nv">client_secret</span><span class="o">=</span>a204abcd1d983434f92b10f2ea62ff <span class="se">\</span>
  --form <span class="nv">username</span><span class="o">=</span>THE_USER_NAME <span class="se">\</span>
  --form <span class="nv">password</span><span class="o">=</span>THE_USER_PASSWORD <span class="se">\</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">http\Client</span><span class="p">;</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">http\Client\Request</span><span class="p">;</span>

<span class="nv">$body</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">http\Message\Body</span><span class="p">;</span>
<span class="nv">$body</span><span class="o">-&gt;</span><span class="na">addForm</span><span class="p">([</span>
  <span class="s1">'grant_type'</span>    <span class="o">=&gt;</span> <span class="s1">'password'</span><span class="p">,</span>
  <span class="s1">'client_id'</span>     <span class="o">=&gt;</span> <span class="s1">'120e3fc4c59a394f8560c8b8b8759b'</span><span class="p">,</span>
  <span class="s1">'client_secret'</span> <span class="o">=&gt;</span> <span class="s1">'a204abcd1d983434f92b10f2ea62ff'</span><span class="p">,</span>
  <span class="s1">'username'</span>      <span class="o">=&gt;</span> <span class="s1">'THE_USER_NAME'</span><span class="p">,</span>
  <span class="s1">'password'</span>      <span class="o">=&gt;</span> <span class="s1">'THE_USER_PASSWORD'</span><span class="p">,</span>
<span class="p">],</span> <span class="kc">null</span><span class="p">);</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setRequestUrl</span><span class="p">(</span><span class="s1">'https://www.nousrassemble.com/fr/oauth/access_token'</span><span class="p">);</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setRequestMethod</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">);</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span><span class="nv">$body</span><span class="p">);</span>

<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
</code></pre>

<blockquote>
<p>You should retrieve this kind of object:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mn4KabcC2P8CLw5LU5xIb8Zsx16aALXRXnHhA01b"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">31536000</span><span class="p">,</span><span class="w">
  </span><span class="nt">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bcuA27CuNtHOzyMakYbXlsqp1JRQ92vE17oAggyb"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>nousrassemble</strong> API needs authenticated users to execute endpoints. <strong>nousrassemble</strong> uses classic OAuth2 system to authenticate users.</p>

<p>You need a <code class="prettyprint">client_id</code> and <code class="prettyprint">client_secret</code> to retrieve an access token.</p>

<aside class="notice">
You must replace <code>client_id</code> and <code>client_secret</code> with your personal credentials.
<p><code>username</code> and <code>password</code> are user credentials. If you use an app without need to authenticate user, you can create a <em>static</em> user especially for this.</p>
</aside>

<p>Once you get the <code class="prettyprint">access_token</code>, you will be able to keep it in your application for 31536000 seconds (1 year).</p>

<h3 id="use-an-access-token">Use an access token</h3>

<p>Now you have an access token, you can reach endpoints just be setting Authorization header to <code class="prettyprint">Bearer access_token</code>.</p>

<blockquote>
<p>To retrieve proposal list for a tenant:</p>
</blockquote>
<pre class="highlight shell"><code>curl <span class="se">\</span>
    -X GET
    -H <span class="s2">"Authorization: Bearer mn4KabcC2P8CLw5LU5xIb8Zsx16aALXRXnHhA01b"</span>
    -H <span class="s2">"Cache-Control: no-cache"</span>
    <span class="s1">'https://grenoble.nousrassemble.com/fr/api/proposals?include=createdby,themes'</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">http\Client</span><span class="p">;</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">http\Client\Request</span><span class="p">;</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setRequestUrl</span><span class="p">(</span><span class="s1">'https://grenoble.nousrassemble.com/fr/api/proposals'</span><span class="p">);</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setRequestMethod</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">);</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setQuery</span><span class="p">(</span><span class="k">new</span> <span class="nx">http\QueryString</span><span class="p">([</span>
  <span class="s1">'include'</span> <span class="o">=&gt;</span> <span class="s1">'createdby,themes'</span>
<span class="p">]));</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setHeaders</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
  <span class="s1">'authorization'</span> <span class="o">=&gt;</span> <span class="s1">'Bearer mn4KabcC2P8CLw5LU5xIb8Zsx16aALXRXnHhA01b'</span>
<span class="p">));</span>

<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">enqueue</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>

<span class="k">echo</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getBody</span><span class="p">();</span>
</code></pre>

          <h2 id="errors">Errors</h2>

<p>The <strong>nousrassemble</strong> API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td><strong>Bad Request</strong></td>
</tr>
<tr>
<td>401</td>
<td><strong>Unauthorized</strong></td>
</tr>
<tr>
<td>403</td>
<td><strong>Forbidden</strong></td>
</tr>
<tr>
<td>404</td>
<td><strong>Not Found</strong></td>
</tr>
<tr>
<td>405</td>
<td><strong>Method Not Allowed</strong></td>
</tr>
<tr>
<td>406</td>
<td><strong>Not Acceptable</strong></td>
</tr>
<tr>
<td>410</td>
<td><strong>Conflict</strong></td>
</tr>
<tr>
<td>410</td>
<td><strong>Gone</strong></td>
</tr>
<tr>
<td>418</td>
<td><strong>I&rsquo;m a teapot</strong></td>
</tr>
<tr>
<td>429</td>
<td><strong>Too Many Requests</strong> : You&rsquo;re requesting too many things! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td><strong>Internal Server Error</strong> : We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td><strong>Service Unavailable</strong> : We&rsquo;re down for maintenance. Please try again later.</td>
</tr>
</tbody></table>

          <h1 id="callbacks">Callbacks</h1>

<h2 id="introduction">Introduction</h2>

<p>Callbacks can be used in your app when you want to open the Nous Rassemble app instead of the website on a mobile or tablet.</p>

<aside class="warning">
Callback are not supported on desktop devices so you need to check the user agent to choose the right URL to call.
</aside>
<pre class="highlight javascript"><code><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">"https://itunes.apple.com/appdir"</span><span class="p">;</span> <span class="p">},</span> <span class="mi">25</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">"appname://"</span><span class="p">;</span>
</code></pre>

<aside class="notice">
You need to call the website too on a mobile or tablet if App is not installed.
Here is a trick you can use.
You can try redirecting the phone to the app, and if nothing happens redirect the phone to a specified page, like this:
</aside>

<h2 id="query-parameters">Query Parameters</h2>

<p>In callbacks below, you need to inject the tenant ID or a proposal ID.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">tenantid</code></td>
<td>The ID of the tenant related with your call</td>
</tr>
<tr>
<td><code class="prettyprint">proposalid</code></td>
<td>The ID of the proposal related with your call</td>
</tr>
</tbody></table>

<h2 id="endpoints">Endpoints</h2>

<h3 id="tenant-home">Tenant home</h3>

<p>To go to the tenant home page, call this link:</p>

<p><a href="nousrassemble://home?tenantid=54f87559fa9b9e12498b456d">nousrassemble://home?tenantid=54f87559fa9b9e12498b456d</a></p>

<hr>

<h3 id="proposal">Proposal</h3>

<p>To display a proposal, call this link:</p>

<p><a href="nousrassemble://proposal?tenantid=54f87559fa9b9e12498b456d&amp;proposalid=5575922e529f9e292bd53cca">nousrassemble://proposal?tenantid=54f87559fa9b9e12498b456d&amp;proposalid=5575922e529f9e292bd53cca</a></p>

<aside class="notice">
You can go to the first comment by appending the hash <code>#timeline</code> to the URL:<br/>
<a href="nousrassemble://proposal?tenantid=54f87559fa9b9e12498b456d&proposalid=5575922e529f9e292bd53cca#timeline">nousrassemble://proposal?tenantid=54f87559fa9b9e12498b456d&proposalid=5575922e529f9e292bd53cca#timeline</a>
</aside>

<h3 id="my-proposal">My proposal</h3>

<p>To display on of my proposals, call this link:</p>

<p><a href="nousrassemble://myproposals?tenantid=54f87559fa9b9e12498b456d&amp;proposalid=5575922e529f9e292bd53cca">nousrassemble://myproposals?tenantid=54f87559fa9b9e12498b456d&amp;proposalid=5575922e529f9e292bd53cca</a></p>

<aside class="notice">
This is useful to display my pending or rejected proposals.
</aside>

<h3 id="add-a-proposal">Add a proposal</h3>

<p><a href="nousrassemble://proposal/add">nousrassemble://proposal/add</a></p>

<h3 id="open-notification-panel">Open notification panel</h3>

<p><a href="nousrassemble://notifications">nousrassemble://notifications</a></p>

<h3 id="open-menu">Open menu</h3>

<p><a href="nousrassemble://menu">nousrassemble://menu</a></p>

<h3 id="open-tenant-selector">Open tenant selector</h3>

<p><a href="nousrassemble://changesite">nousrassemble://changesite</a></p>

<h3 id="my-favorites">My favorites</h3>

<p><a href="nousrassemble://myfavorites">nousrassemble://myfavorites</a></p>

<h3 id="my-proposals">My proposals</h3>

<p><a href="nousrassemble://myproposals">nousrassemble://myproposals</a></p>

<h3 id="my-votes">My votes</h3>

<p><a href="nousrassemble://myvotes">nousrassemble://myvotes</a></p>

<h3 id="my-profile">My profile</h3>

<p><a href="nousrassemble://profile">nousrassemble://profile</a></p>

<h3 id="my-parameters">My parameters</h3>

<p><a href="nousrassemble://parameters">nousrassemble://parameters</a></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">cURL</a>
                <a href="#" data-language-name="php">PHP</a>
          </div>
      </div>
    </div>
  </body>
</html>
